# coding=utf-8
import datetime
import requests
from django.core.mail import send_mail
from django.http import HttpResponse, HttpResponseRedirect
from django.shortcuts import render
from django.template.defaulttags import register
# Create your views here.
from datetime import datetime
from books.forms import ContactForm
from books.models import Book
import json


text = '{"list":[{"id":0,"passengerOrderHashMap":[[{"id":2,"role":2,"phoneNumber":"0666076706","fbProfile":{"id":"id_link2","type":2,"link":"https://plus.google.com/+AlexanderZhovnuvaty","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя2","surName":"Фамилия2","gender":2,"age":34,"email":"email2","birthday":"1983-03-26"}},{"id":1576,"totalSeats":2,"depLocation":{"mLongitudeE6":24007593,"mLatitudeE6":49823836,"mAltitude":0},"destLocation":{"mLongitudeE6":24053202,"mLatitudeE6":49864560,"mAltitude":0},"depAddress":"From 1","destAddress":"To 1","timestamp":1444904927000,"clientType":1,"stateId":1,"price":40,"polygon":"POLYGON((24.007575983305774 49.82098617345401,24.007436170646823 49.82099049023218,24.00729673821261 49.82100166209261,24.007158021908076 49.82101966212133,24.007020355912953 49.82104444695467,24.006884071876684 49.82107595688381,24.006749498119444 49.821114115998576,24.006616958841207 49.8211588323703,24.006486773340697 49.82120999827334,24.006359255246192 49.82126749044455,24.00623471175995 49.821331170380255,24.00611344291814 49.82140088466991,24.005995740868016 49.821476465365684,24.005881889164137 49.82155773038707,24.005772162085222 49.8216444839595,24.005666823973417 49.82173651708602,24.005566128597465 49.82183360805079,24.005470318541338 49.82193552295314,24.00537962461986 49.82204201627116,24.00529426532263 49.822152831453124,24.005214446287667 49.822267701535544,24.005140359806024 49.82238634978633,24.00507218435852 49.82250849037145,24.005010084185784 49.822633829043546,24.004954208892567 49.822762063850774,24.004904693087347 49.82289288586425,24.004861656058033 49.823025979922285,24.004825201484604 49.82316102538964,24.004795417189314 49.82329769692995,24.004772374925142 49.8234356652895,24.00475613020292 49.823574598090445,24.00474672215761 49.823714160631475,24.00474417345401 49.82385401669422,24.004748490232178 49.82399382935318,24.004759662092614 49.82413326178739,24.004777662121324 49.82427197809192,24.004802446954667 49.82440964408704,24.00483395688381 49.824545928123314,24.00487211599857 49.82468050188055,24.0049168323703 49.82481304115879,24.004967998273337 49.8249432266593,24.00502549044455 49.8250707447538,24.005089170380252 49.825195288240046,24.005158884669907 49.82531655708186,24.012933184542515 49.838103174384536,24.012966295275298 49.83815630888119,24.013044443273927 49.83827232226183,24.013128189646643 49.83838436135872,24.01321733264111 49.838492156259875,24.023059674389405 49.84981610032652,24.023151572234674 49.84991685809981,24.023250730352228 49.85001551853717,24.023354610067692 49.8501091946755,24.02346296112574 49.850197660840756,24.02357552249918 49.85028070391022,24.03653164776279 49.85935675980257,24.036646015948143 49.85943283561962,24.036766111568692 49.859504552117734,24.036889581490584 49.859570289417384,24.05192481460607 49.86710767215571,24.05199941937839 49.867143725177336,24.05212764532497 49.8671996208015,24.052258459486065 49.86724915734795,24.052391546718898 49.867292215478805,24.052526586404678 49.86732869146326,24.052663253220963 49.86735849742747,24.05280121792543 49.867381561566255,24.05294014814902 49.86739782831609,24.053079709196652 49.867407258488946,24.053219564853542 49.867409829366714,24.053359378195164 49.867405534755925,24.053498812398924 49.86739438500266,24.053637531555623 49.867376406967665,24.05377520147865 49.8673516439616,24.053911490509115 49.86732015564071,24.054046070314794 49.86728201786312,24.054178616681156 49.86723732250608,24.05430881029239 49.86718617724461,24.054436337500686 49.86712870529214,24.054560891081827 49.86706504510362,24.054682170975326 49.86699535004204,24.0547998850073 49.86691978800889,24.05491374959433 49.86683854103974,24.05502349042666 49.86675180486564,24.055128843129005 49.866659788441645,24.055229553897483 49.86656271344338,24.055325380111025 49.866460813733,24.055416090915898 49.86635433479585,24.05550146778182 49.86624353314902,24.055581305028447 49.86612867572337,24.05565541032086 49.86601003922049,24.055723605132915 49.86588790944613,24.055785725177337 49.865762580621606,24.055841620801502 49.865634354675024,24.05589115734795 49.865503540513934,24.055934215478807 49.865370453281095,24.055970691463262 49.86523541359532,24.05600049742747 49.86509874677903,24.056023561566256 49.86496078207456,24.05603982831609 49.86482185185098,24.05604925848895 49.864682290803344,24.056051829366716 49.864542435146454,24.056047534755923 49.864402621804835,24.056036385002663 49.86426318760107,24.05601840696767 49.86412446844437,24.055993643961603 49.863986798521346,24.055962155640714 49.86385050949088,24.055924017863124 49.8637159296852,24.05587932250608 49.86358338331884,24.055828177244614 49.863453189707606,24.05577070529214 49.863325662499314,24.055707045103627 49.86320110891817,24.055637350042044 49.86307982902467,24.047868188820505 49.85029709823012,24.047834701394123 49.85024335528382,24.04775654265666 49.85012734913771,24.047672785913022 49.85001531779356,24.04758363294054 49.849907531144694,24.0377393482322 49.83858346895387,24.037647531187346 49.83848281386243,24.037548368449748 49.83838415806864,24.03744448434765 49.83829048679499,24.03733612914695 49.83820202570377,24.037223563884822 49.838118987905524,24.024266316056092 49.82904305013735,24.02415242183641 49.82896728101203,24.024032337068235 49.828895546343766,24.023908877094087 49.82882979036336,24.008871570852694 49.821288521116905,24.00879617095645 49.82125208418579,24.008667936149223 49.82119620889257,24.00853711413575 49.82114669308735,24.008404020077712 49.821103656058035,24.00826897461036 49.8210672014846,24.00813230307005 49.821037417189316,24.007994334710492 49.82101437492514,24.007855401909556 49.82099813020292,24.00771583936852 49.82098872215761,24.007575983305774 49.82098617345401))"}],[{"id":1,"role":2,"phoneNumber":"0666076705","gPlusProfile":{"id":"id_link1","type":1,"link":"https://plus.google.com/118055503722424615520","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя1","surName":"Фамилия1","gender":1,"age":33,"email":"email1","birthday":"1982-03-25"}},{"id":1575,"totalSeats":2,"depLocation":{"mLongitudeE6":23990761,"mLatitudeE6":49811403,"mAltitude":0},"destLocation":{"mLongitudeE6":24010512,"mLatitudeE6":49826688,"mAltitude":0},"depAddress":"From 0","destAddress":"To 0","timestamp":1444904927000,"clientType":1,"stateId":1,"price":40,"polygon":"POLYGON((23.99076330186452 49.81027401069995,23.990707902212527 49.810275257669865,23.990652630477758 49.810279221469834,23.99059761981466 49.81028589255071,23.990543002748737 49.810295254841286,23.990488910857287 49.81030728578697,23.990435474452415 49.81032195640417,23.9903828222671 49.81033923135008,23.99033108114507 49.81035906900784,23.990280375735214 49.8103814215868,23.99023082819131 49.810406235237636,23.990182557877734 49.810433450182096,23.99013568108189 49.810463000856984,23.990090310734097 49.81049481607214,23.99004655613549 49.81052881918193,23.99000452269473 49.810564928269876,23.989964311674058 49.81060305634603,23.989926019945344 49.810643111556516,23.989889739756716 49.81068499740481,23.989855558510328 49.810728612984256,23.989823558551798 49.81077385322109,23.989793816971826 49.810820609127624,23.989766405420482 49.81086876806477,23.9897413899346 49.810918214013455,23.98971883077867 49.81096882785403,23.98969878229968 49.811020487653344,23.989681292796167 49.8110730689584,23.98966640440188 49.811126445096235,23.989654152984265 49.81118048747906,23.989644568058058 49.81123506591403,23.98963767271419 49.81129004891693,23.98963348356414 49.81134530402888,23.989632010699946 49.81140069813548,23.989633257669862 49.81145609778747,23.98963722146983 49.811511369522236,23.989643892550713 49.81156638018534,23.989653254841283 49.81162099725126,23.98966528578697 49.81167508914271,23.98967995640417 49.81172852554758,23.98969723135008 49.8117811777329,23.989717069007842 49.81183291885493,23.9897394215868 49.81188362426479,23.989764235237637 49.81193317180869,23.989791450182093 49.81198144212227,23.98982100085698 49.8120283189181,23.98985281607214 49.8120736892659,23.99347041648895 49.81697230136988,23.993476607600293 49.81698060481172,23.993511010683196 49.81702404562503,23.993547503865763 49.81706574603272,23.993585999232714 49.81710560557484,23.997919518451305 49.821377720446975,23.99795486619155 49.821411097479526,23.99799686615964 49.82144724549545,23.998040589236 49.82148128912875,23.99808593008791 49.82151314636533,23.998132779485292 49.82154274045831,24.003699052690333 49.82487062558414,24.003718863618655 49.82488219824715,24.00376765267773 49.82490847188583,24.003817672154593 49.82493231991109,24.01005127931415 49.82771870780915,24.010064992072113 49.82772472853275,24.01011640037075 49.827745413387255,24.010168761703543 49.827763550840295,24.01022194992746 49.82777909719715,24.010275836907404 49.827792015005286,24.01033029282492 49.82780227314458,24.010385186490943 49.82780984690227,24.010440385661816 49.827814718032506,24.010495757357898 49.82781687480031,24.01055116818393 49.82781631200985,24.010606484650378 49.82781303101693,24.010661573495025 49.82780703972574,24.010716302004024 49.82779835256984,24.0107705383316 49.82778699047735,24.010824151817687 49.827772980820534,24.010877013302704 49.827756357349884,24.010928995438704 49.827737160112804,24.010979972996168 49.82771543535712,24.011029823165696 49.827691235419664,24.01107842585386 49.82766461860022,24.011125663972532 49.82763564902101,24.011171423720942 49.82760439647231,24.01121559485985 49.82757093624424,24.01125807097711 49.82753534894543,24.01129874974404 49.827497720308784,24.011337533161928 49.827458140984994,24.011374327798116 49.827416706324115,24.01140904501111 49.82737351614587,24.0114416011641 49.827328674499185,24.011471917826462 49.82728228941152,24.011499921962702 49.82723447262861,24.011525546108402 49.82718533934527,24.011548728532752 49.82713500792788,24.011569413387257 49.82708359962925,24.011587550840293 49.82703123829645,24.01160309719715 49.82697805007254,24.01161601500529 49.82692416309259,24.011626273144582 49.82686970717507,24.01163384690227 49.82681481350905,24.011638718032508 49.82675961433818,24.011640874800317 49.826704242642094,24.011640312009852 49.826648831816065,24.011637031016928 49.826593515349614,24.011631039725746 49.82653842650497,24.011622352569844 49.826483697995975,24.01161099047735 49.8264294616684,24.011596980820535 49.82637584818231,24.01158035734989 49.82632298669729,24.01156116011281 49.82627100456129,24.011539435357122 49.82622002700383,24.01151523541967 49.826170176834296,24.011488618600215 49.826121574146136,24.011459649021013 49.82607433602747,24.011428396472315 49.82602857627906,24.007837943446397 49.8210389491509,24.007815719140435 49.82100911364983,24.007780821723866 49.820966068944095,24.007743854239163 49.820924788422666,24.007704905744234 49.82088537153393,24.003271116333416 49.8166132410244,24.00325168953936 49.8165949601755,24.003209980266224 49.81655847712589,24.003166531095335 49.81652408459874,24.003121446699556 49.81649186544866,24.00307483569114 49.81646189729441,23.997608417551213 49.81313402780597,23.997567291847545 49.81311016333703,23.997518145080218 49.813084565062944,23.997467801464552 49.81306140914067,23.991207462041217 49.8103660362668,23.991195172145964 49.81036083077867,23.991143512346653 49.81034078229968,23.991090931041594 49.81032329279617,23.99103755490376 49.81030840440188,23.990983512520938 49.810296152984264,23.990928934085964 49.81028656805806,23.990873951083067 49.81027967271419,23.990818695971118 49.81027548356414,23.99076330186452 49.81027401069995))"}],[{"id":5,"role":2,"phoneNumber":"0666076708","vkProfile":{"id":"id_link8","type":3,"link":"https://www.facebook.com/app_scoped_user_id/1637344933216693/","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя8","surName":"Фамилия8","gender":2,"age":34,"email":"email8","birthday":"1983-03-28"}},{"id":1578,"totalSeats":2,"depLocation":{"mLongitudeE6":24017314,"mLatitudeE6":49812844,"mAltitude":0},"destLocation":{"mLongitudeE6":24000663,"mLatitudeE6":49816720,"mAltitude":0},"depAddress":"From 3","destAddress":"To 3","timestamp":1444904927000,"clientType":1,"stateId":1,"price":40,"polygon":"POLYGON((24.01731968267015 49.81219603114531,24.017287881500387 49.81219653281676,24.012892885206675 49.81237382475058,24.012883489997005 49.812374272068716,24.0128517850148 49.8123767940076,24.01282024196831 49.81238086859844,24.008499809458893 49.81304713636209,24.008489763894296 49.81304876638168,24.008458550855075 49.81305487475749,24.00842767513712 49.81306250732674,24.008397211122745 49.813071645701896,24.004317632019184 49.81440537793822,24.004317135295654 49.81440554055326,24.0042871649528 49.81441618689637,24.004257753101832 49.81442829099052,24.000401761008522 49.81612699905673,24.000396014009652 49.81612956421996,24.000367364295403 49.81614337580734,24.000339426793463 49.81615857653291,24.00031226880772 49.81617512977678,24.000285955764138 49.81619299566075,24.000260551053145 49.816212131144326,24.000236115876916 49.81623249012846,24.000212709101927 49.81625402356658,24.000190387117158 49.81627667958274,24.000169203698217 49.81630040359662,24.000149209877815 49.816325138454985,24.000130453822823 49.81635082456939,24.00011298071822 49.81637740005976,24.00009683265824 49.81640480090338,24.00008204854498 49.816432961089234,24.000068663994654 49.81646181277697,24.000056711251826 49.816491286460334,24.0000462191117 49.81652131113466,24.000037212850753 49.81655181446786,24.000029714165862 49.81658272297473,24.000023741122018 49.81661396219398,24.0000193081088 49.816645456867604,24.00001642580573 49.816677131122155,24.000015101156524 49.81670890865159,24.000015337352387 49.81674071290105,24.000017133824294 49.816772467251326,24.000020486244388 49.81680409520339,24.000025386536397 49.81683552056275,24.00003182289509 49.816866667622946,24.000039779814713 49.816897461348,24.000049238126348 49.816927827553116,24.000060175044098 49.81695769308346,24.000072564219966 49.81698698599035,24.000086375807346 49.81701563570459,24.000101576532913 49.81704357320653,24.000118129776787 49.817070731192274,24.000135995660752 49.81709704423586,24.00015513114433 49.817122448946854,24.000175490128466 49.81714688412308,24.000197023566585 49.81717029089807,24.000219679582745 49.81719261288284,24.00024340359662 49.81721379630178,24.000268138454985 49.81723379012218,24.000293824569397 49.81725254617717,24.000320400059756 49.81727001928178,24.00034780090338 49.817286167341756,24.000375961089237 49.81730095145502,24.00040481277697 49.81731433600534,24.00043428646034 49.81732628874817,24.00046431113466 49.8173367808883,24.000494814467856 49.81734578714924,24.000525722974732 49.81735328583413,24.000556962193986 49.81735925887798,24.000588456867604 49.817363691891195,24.000620131122158 49.81736657419427,24.00065190865159 49.81736789884347,24.000683712901054 49.81736766264761,24.005101729851678 49.817226370034405,24.005116530812987 49.81722572724349,24.005148235794596 49.817223205297104,24.005179778840123 49.8172191306988,24.0095002091488 49.816552862228036,24.009510255434275 49.81655123208321,24.00954146846515 49.81654512366477,24.009572344172682 49.81653749105335,24.009602808174577 49.81652835263659,24.013682366251974 49.81519462110739,24.013689030413744 49.815192402340934,24.013718892422574 49.815181455811754,24.013748181340578 49.81516905720882,24.01758117600388 49.813434349821996,24.017585905311233 49.81343218656148,24.01761443873602 49.813418136303746,24.017642248377577 49.81340270290137,24.01766926724004 49.81338592353477,24.017695430232607 49.8133678386269,24.01772067432633 49.813348491745906,24.017744938705984 49.8133279295001,24.01776816491655 49.81330620142574,24.017790297004048 49.81328335986767,24.017811281650346 49.813259459853185,24.017831068301593 49.81323455895953,24.01784960929001 49.81320871717513,24.017866859948736 49.81318199675511,24.017882778719418 49.8131544620713,24.017897327252346 49.81312617945717,24.01791047049883 49.81309721704802,24.01792217679564 49.81306764461681,24.017932417941278 49.81303753340613,24.017941169263928 49.813006955956524,24.017948409680887 49.81297598593175,24.017954121749355 49.812944697941305,24.017958291708464 49.8129131673607,24.017960909512414 49.812881470149854,24.017961968854685 49.81284968267015,24.01796146718323 49.812817881500386,24.01795940570662 49.812786143252374,24.01795578939113 49.812754544386344,24.017950626948785 49.81272316102672,24.017943930816358 49.81269206877876,24.017935717125418 49.81266134254643,24.017926005663465 49.81263105635189,24.017914819826267 49.812601283157264,24.01790218656148 49.81257209468876,24.017888136303746 49.81254356126398,24.01787270290137 49.81251575162242,24.017855923534768 49.81248873275995,24.017837838626903 49.81246256976739,24.017818491745903 49.81243732567366,24.017797929500098 49.81241306129401,24.017776201425743 49.81238983508345,24.017753359867665 49.81236770299595,24.017729459853186 49.81234671834965,24.01770455895953 49.8123269316984,24.01767871717513 49.81230839070999,24.017651996755113 49.812291140051265,24.017624462071304 49.81227522128058,24.017596179457176 49.81226067274765,24.017567217048015 49.812247529501164,24.01753764461681 49.81223582320436,24.017507533406132 49.81222558205872,24.01747695595653 49.81221683073607,24.01744598593175 49.812209590319114,24.017414697941305 49.81220387825064,24.017383167360695 49.81219970829153,24.01735147014986 49.81219709048759,24.01731968267015 49.81219603114531))"}]],"stops":{"0":{"passengerId":5,"orderId":1578,"type":1,"length":1000},"1":{"passengerId":1,"orderId":1575,"type":1,"length":1000},"2":{"passengerId":5,"orderId":1578,"type":2,"length":1000},"3":{"passengerId":2,"orderId":1576,"type":1,"length":1000},"4":{"passengerId":1,"orderId":1575,"type":2,"length":1000},"5":{"passengerId":2,"orderId":1576,"type":2,"length":1000}},"stateId":1,"price":0},{"id":0,"passengerOrderHashMap":[[{"id":2,"role":2,"phoneNumber":"0666076706","fbProfile":{"id":"id_link2","type":2,"link":"https://plus.google.com/+AlexanderZhovnuvaty","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя2","surName":"Фамилия2","gender":2,"age":34,"email":"email2","birthday":"1983-03-26"}},{"id":1576,"totalSeats":2,"depLocation":{"mLongitudeE6":24007593,"mLatitudeE6":49823836,"mAltitude":0},"destLocation":{"mLongitudeE6":24053202,"mLatitudeE6":49864560,"mAltitude":0},"depAddress":"From 1","destAddress":"To 1","timestamp":1444904927000,"clientType":1,"stateId":1,"price":30,"polygon":"POLYGON((24.007575983305774 49.82098617345401,24.007436170646823 49.82099049023218,24.00729673821261 49.82100166209261,24.007158021908076 49.82101966212133,24.007020355912953 49.82104444695467,24.006884071876684 49.82107595688381,24.006749498119444 49.821114115998576,24.006616958841207 49.8211588323703,24.006486773340697 49.82120999827334,24.006359255246192 49.82126749044455,24.00623471175995 49.821331170380255,24.00611344291814 49.82140088466991,24.005995740868016 49.821476465365684,24.005881889164137 49.82155773038707,24.005772162085222 49.8216444839595,24.005666823973417 49.82173651708602,24.005566128597465 49.82183360805079,24.005470318541338 49.82193552295314,24.00537962461986 49.82204201627116,24.00529426532263 49.822152831453124,24.005214446287667 49.822267701535544,24.005140359806024 49.82238634978633,24.00507218435852 49.82250849037145,24.005010084185784 49.822633829043546,24.004954208892567 49.822762063850774,24.004904693087347 49.82289288586425,24.004861656058033 49.823025979922285,24.004825201484604 49.82316102538964,24.004795417189314 49.82329769692995,24.004772374925142 49.8234356652895,24.00475613020292 49.823574598090445,24.00474672215761 49.823714160631475,24.00474417345401 49.82385401669422,24.004748490232178 49.82399382935318,24.004759662092614 49.82413326178739,24.004777662121324 49.82427197809192,24.004802446954667 49.82440964408704,24.00483395688381 49.824545928123314,24.00487211599857 49.82468050188055,24.0049168323703 49.82481304115879,24.004967998273337 49.8249432266593,24.00502549044455 49.8250707447538,24.005089170380252 49.825195288240046,24.005158884669907 49.82531655708186,24.012933184542515 49.838103174384536,24.012966295275298 49.83815630888119,24.013044443273927 49.83827232226183,24.013128189646643 49.83838436135872,24.01321733264111 49.838492156259875,24.023059674389405 49.84981610032652,24.023151572234674 49.84991685809981,24.023250730352228 49.85001551853717,24.023354610067692 49.8501091946755,24.02346296112574 49.850197660840756,24.02357552249918 49.85028070391022,24.03653164776279 49.85935675980257,24.036646015948143 49.85943283561962,24.036766111568692 49.859504552117734,24.036889581490584 49.859570289417384,24.05192481460607 49.86710767215571,24.05199941937839 49.867143725177336,24.05212764532497 49.8671996208015,24.052258459486065 49.86724915734795,24.052391546718898 49.867292215478805,24.052526586404678 49.86732869146326,24.052663253220963 49.86735849742747,24.05280121792543 49.867381561566255,24.05294014814902 49.86739782831609,24.053079709196652 49.867407258488946,24.053219564853542 49.867409829366714,24.053359378195164 49.867405534755925,24.053498812398924 49.86739438500266,24.053637531555623 49.867376406967665,24.05377520147865 49.8673516439616,24.053911490509115 49.86732015564071,24.054046070314794 49.86728201786312,24.054178616681156 49.86723732250608,24.05430881029239 49.86718617724461,24.054436337500686 49.86712870529214,24.054560891081827 49.86706504510362,24.054682170975326 49.86699535004204,24.0547998850073 49.86691978800889,24.05491374959433 49.86683854103974,24.05502349042666 49.86675180486564,24.055128843129005 49.866659788441645,24.055229553897483 49.86656271344338,24.055325380111025 49.866460813733,24.055416090915898 49.86635433479585,24.05550146778182 49.86624353314902,24.055581305028447 49.86612867572337,24.05565541032086 49.86601003922049,24.055723605132915 49.86588790944613,24.055785725177337 49.865762580621606,24.055841620801502 49.865634354675024,24.05589115734795 49.865503540513934,24.055934215478807 49.865370453281095,24.055970691463262 49.86523541359532,24.05600049742747 49.86509874677903,24.056023561566256 49.86496078207456,24.05603982831609 49.86482185185098,24.05604925848895 49.864682290803344,24.056051829366716 49.864542435146454,24.056047534755923 49.864402621804835,24.056036385002663 49.86426318760107,24.05601840696767 49.86412446844437,24.055993643961603 49.863986798521346,24.055962155640714 49.86385050949088,24.055924017863124 49.8637159296852,24.05587932250608 49.86358338331884,24.055828177244614 49.863453189707606,24.05577070529214 49.863325662499314,24.055707045103627 49.86320110891817,24.055637350042044 49.86307982902467,24.047868188820505 49.85029709823012,24.047834701394123 49.85024335528382,24.04775654265666 49.85012734913771,24.047672785913022 49.85001531779356,24.04758363294054 49.849907531144694,24.0377393482322 49.83858346895387,24.037647531187346 49.83848281386243,24.037548368449748 49.83838415806864,24.03744448434765 49.83829048679499,24.03733612914695 49.83820202570377,24.037223563884822 49.838118987905524,24.024266316056092 49.82904305013735,24.02415242183641 49.82896728101203,24.024032337068235 49.828895546343766,24.023908877094087 49.82882979036336,24.008871570852694 49.821288521116905,24.00879617095645 49.82125208418579,24.008667936149223 49.82119620889257,24.00853711413575 49.82114669308735,24.008404020077712 49.821103656058035,24.00826897461036 49.8210672014846,24.00813230307005 49.821037417189316,24.007994334710492 49.82101437492514,24.007855401909556 49.82099813020292,24.00771583936852 49.82098872215761,24.007575983305774 49.82098617345401))"}],[{"id":4,"role":2,"phoneNumber":"0666076707","vkProfile":{"id":"id_link5","type":3,"link":"https://plus.google.com/118055503722424615520","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя5","surName":"Фамилия5","gender":2,"age":34,"email":"email5","birthday":"1983-03-27"}},{"id":1577,"totalSeats":2,"depLocation":{"mLongitudeE6":24017829,"mLatitudeE6":49801100,"mAltitude":0},"destLocation":{"mLongitudeE6":24029501,"mLatitudeE6":49844071,"mAltitude":0},"depAddress":"From 2","destAddress":"To 2","timestamp":1444904927000,"clientType":1,"stateId":1,"price":30,"polygon":"POLYGON((24.017802910582834 49.79862514684481,24.017681506720052 49.79862940806085,24.017560458181503 49.79863962114926,24.017440056583713 49.798655761505835,24.01732059198468 49.798677790247034,24.01720235218509 49.79870565430368,24.017085622034973 49.79873928654883,24.016970682747488 49.79877860595946,24.016857811221442 49.79882351781166,24.01674727937423 49.79887391390885,24.01663935348675 49.79892967284242,24.016534293561925 49.798990660284204,24.01643235269831 49.799056729310124,24.016333776480376 49.79912772075411,24.01623880238687 49.79920346359154,24.016147659218696 49.7992837753513,24.016060566547733 49.79936846255532,24.015977734187853 49.79945732118471,24.015899361689467 49.79955013717125,24.015825637858786 49.79964668691309,24.01575674030298 49.79974673781346,24.01569283500229 49.799850048840966,24.015634075910185 49.79995637111029,24.015580604582468 49.80006544848179,24.015532549836244 49.80017701817851,24.01549002743961 49.80029081141927,24.015453139832747 49.800406554066214,24.01542197588113 49.800523967285145,24.01539661066144 49.80064276821734,24.01537710528072 49.80076267066095,24.013781126140348 49.81236312272178,24.01377334998497 49.812425501181984,24.01376282156608 49.81254652270179,24.013758244073653 49.8126679150509,24.01375962853527 49.81278938578452,24.013766971615635 49.81291064226901,24.014708205700217 49.82395363814743,24.014710395002684 49.82397791112604,24.01472486739318 49.82409852458206,24.01474524057283 49.82421828262735,24.01477146546085 49.82433689675429,24.0148034788792 49.824454081211044,24.014841203704744 49.82456955369001,24.014884549055076 49.82468303600786,24.01493341050745 49.82479425477575,24.01979015579809 49.83515125882933,24.019798869968366 49.835169644805575,24.019854021471758 49.835277882356976,24.019914417507668 49.835383283375506,24.019979912576762 49.83548559394087,24.020050348895676 49.83558456757795,24.027521348660823 49.845555115585135,24.027595417862745 49.8456491392053,24.027675150044995 49.845740789818905,24.027759283268804 49.845828417762576,24.027847614849858 49.84591181193293,24.02793993198965 49.845990771426095,24.028036012288094 49.84606510602175,24.028135624279347 49.846134636641324,24.02823852798939 49.846199195779484,24.02834447551417 49.8462586279076,24.028453211616828 49.846312789848476,24.028564474342563 49.84636155112125,24.028677995649726 49.84640479425574,24.02879350205554 49.84644241507546,24.02891071529496 49.846474322948545,24.029029352991024 49.84650044100614,24.029149129335135 49.84652070632756,24.029269755775584 49.84653507009187,24.02939094171271 49.84654349769549,24.029512395198978 49.84654596883561,24.029633823642303 49.84654247755902,24.029754934510926 49.84653303227651,24.029875436038157 49.8465176557426,24.029995037925264 49.846496385000705,24.030113452040823 49.846469271293905,24.03023039311486 49.846436379941494,24.030345579426083 49.84639779018162,24.030458733480582 49.8463535949804,24.03056958268032 49.84630390080793,24.03067785997988 49.84624882738185,24.030783304529752 49.84618850737884,24.03088566230478 49.846123086115085,24.030984686716124 49.84605272119614,24.0310801392053 49.84597758213725,24.031171789818902 49.845897849955,24.031259417762573 49.84581371673119,24.031342811932927 49.84572538515014,24.031421771426093 49.84563306801035,24.031496106021745 49.8455369877119,24.031565636641325 49.84543737572065,24.03163019577948 49.845334472010606,24.0316896279076 49.845228524485826,24.031743789848477 49.845119788383165,24.03179255112125 49.845008525657434,24.03183579425574 49.84489500435027,24.031873415075456 49.84477949794446,24.031905322948543 49.84466228470504,24.031931441006137 49.84454364700897,24.031951706327558 49.84442387066486,24.033618554831683 49.832852239089235,24.033628572770976 49.83277384124354,24.033639077668276 49.832652817679744,24.033643631567152 49.83253142444325,24.033642223496866 49.832409953981006,24.03363485684958 49.832288698925986,24.03269144489051 49.82124551620568,24.032689260257243 49.82122134211218,24.032674769244796 49.82110073089206,24.032654377575337 49.82098097599372,24.032628134374185 49.82086236591719,24.032596102863515 49.820745186404544,24.032558360210036 49.82062971975149,24.032514997339106 49.8205162441273,24.032466118715686 49.820405032904695,24.027607510231483 49.810048215693,24.027595858254728 49.810023727663754,24.027540394096366 49.80991564999262,24.027479693627047 49.80981042400303,24.02741390307951 49.80970830319362,24.02734318094895 49.80960953358235,24.0198053528881 49.79961016508998,24.019801279245893 49.79960477648038,24.01972553640846 49.799509802386865,24.0196452246487 49.799418659218695,24.019560537444676 49.799331566547735,24.019471678815286 49.799248734187856,24.01937886282875 49.79917036168947,24.019282313086904 49.79909663785879,24.01918226218654 49.799027740302975,24.019078951159035 49.79896383500229,24.018972628889703 49.798905075910184,24.01886355151821 49.79885160458247,24.01875198182149 49.798803549836244,24.01863818858072 49.79876102743961,24.018522445933783 49.79872413983275,24.018405032714853 49.798692975881124,24.018286231782657 49.79866761066144,24.01816632933905 49.79864810528072,24.018045614239515 49.79863450672914,24.017924377297305 49.7986268477668,24.017802910582834 49.79862514684481))"}],[{"id":1,"role":2,"phoneNumber":"0666076705","gPlusProfile":{"id":"id_link1","type":1,"link":"https://plus.google.com/118055503722424615520","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя1","surName":"Фамилия1","gender":1,"age":33,"email":"email1","birthday":"1982-03-25"}},{"id":1575,"totalSeats":2,"depLocation":{"mLongitudeE6":23990761,"mLatitudeE6":49811403,"mAltitude":0},"destLocation":{"mLongitudeE6":24010512,"mLatitudeE6":49826688,"mAltitude":0},"depAddress":"From 0","destAddress":"To 0","timestamp":1444904927000,"clientType":1,"stateId":1,"price":30,"polygon":"POLYGON((23.99076330186452 49.81027401069995,23.990707902212527 49.810275257669865,23.990652630477758 49.810279221469834,23.99059761981466 49.81028589255071,23.990543002748737 49.810295254841286,23.990488910857287 49.81030728578697,23.990435474452415 49.81032195640417,23.9903828222671 49.81033923135008,23.99033108114507 49.81035906900784,23.990280375735214 49.8103814215868,23.99023082819131 49.810406235237636,23.990182557877734 49.810433450182096,23.99013568108189 49.810463000856984,23.990090310734097 49.81049481607214,23.99004655613549 49.81052881918193,23.99000452269473 49.810564928269876,23.989964311674058 49.81060305634603,23.989926019945344 49.810643111556516,23.989889739756716 49.81068499740481,23.989855558510328 49.810728612984256,23.989823558551798 49.81077385322109,23.989793816971826 49.810820609127624,23.989766405420482 49.81086876806477,23.9897413899346 49.810918214013455,23.98971883077867 49.81096882785403,23.98969878229968 49.811020487653344,23.989681292796167 49.8110730689584,23.98966640440188 49.811126445096235,23.989654152984265 49.81118048747906,23.989644568058058 49.81123506591403,23.98963767271419 49.81129004891693,23.98963348356414 49.81134530402888,23.989632010699946 49.81140069813548,23.989633257669862 49.81145609778747,23.98963722146983 49.811511369522236,23.989643892550713 49.81156638018534,23.989653254841283 49.81162099725126,23.98966528578697 49.81167508914271,23.98967995640417 49.81172852554758,23.98969723135008 49.8117811777329,23.989717069007842 49.81183291885493,23.9897394215868 49.81188362426479,23.989764235237637 49.81193317180869,23.989791450182093 49.81198144212227,23.98982100085698 49.8120283189181,23.98985281607214 49.8120736892659,23.99347041648895 49.81697230136988,23.993476607600293 49.81698060481172,23.993511010683196 49.81702404562503,23.993547503865763 49.81706574603272,23.993585999232714 49.81710560557484,23.997919518451305 49.821377720446975,23.99795486619155 49.821411097479526,23.99799686615964 49.82144724549545,23.998040589236 49.82148128912875,23.99808593008791 49.82151314636533,23.998132779485292 49.82154274045831,24.003699052690333 49.82487062558414,24.003718863618655 49.82488219824715,24.00376765267773 49.82490847188583,24.003817672154593 49.82493231991109,24.01005127931415 49.82771870780915,24.010064992072113 49.82772472853275,24.01011640037075 49.827745413387255,24.010168761703543 49.827763550840295,24.01022194992746 49.82777909719715,24.010275836907404 49.827792015005286,24.01033029282492 49.82780227314458,24.010385186490943 49.82780984690227,24.010440385661816 49.827814718032506,24.010495757357898 49.82781687480031,24.01055116818393 49.82781631200985,24.010606484650378 49.82781303101693,24.010661573495025 49.82780703972574,24.010716302004024 49.82779835256984,24.0107705383316 49.82778699047735,24.010824151817687 49.827772980820534,24.010877013302704 49.827756357349884,24.010928995438704 49.827737160112804,24.010979972996168 49.82771543535712,24.011029823165696 49.827691235419664,24.01107842585386 49.82766461860022,24.011125663972532 49.82763564902101,24.011171423720942 49.82760439647231,24.01121559485985 49.82757093624424,24.01125807097711 49.82753534894543,24.01129874974404 49.827497720308784,24.011337533161928 49.827458140984994,24.011374327798116 49.827416706324115,24.01140904501111 49.82737351614587,24.0114416011641 49.827328674499185,24.011471917826462 49.82728228941152,24.011499921962702 49.82723447262861,24.011525546108402 49.82718533934527,24.011548728532752 49.82713500792788,24.011569413387257 49.82708359962925,24.011587550840293 49.82703123829645,24.01160309719715 49.82697805007254,24.01161601500529 49.82692416309259,24.011626273144582 49.82686970717507,24.01163384690227 49.82681481350905,24.011638718032508 49.82675961433818,24.011640874800317 49.826704242642094,24.011640312009852 49.826648831816065,24.011637031016928 49.826593515349614,24.011631039725746 49.82653842650497,24.011622352569844 49.826483697995975,24.01161099047735 49.8264294616684,24.011596980820535 49.82637584818231,24.01158035734989 49.82632298669729,24.01156116011281 49.82627100456129,24.011539435357122 49.82622002700383,24.01151523541967 49.826170176834296,24.011488618600215 49.826121574146136,24.011459649021013 49.82607433602747,24.011428396472315 49.82602857627906,24.007837943446397 49.8210389491509,24.007815719140435 49.82100911364983,24.007780821723866 49.820966068944095,24.007743854239163 49.820924788422666,24.007704905744234 49.82088537153393,24.003271116333416 49.8166132410244,24.00325168953936 49.8165949601755,24.003209980266224 49.81655847712589,24.003166531095335 49.81652408459874,24.003121446699556 49.81649186544866,24.00307483569114 49.81646189729441,23.997608417551213 49.81313402780597,23.997567291847545 49.81311016333703,23.997518145080218 49.813084565062944,23.997467801464552 49.81306140914067,23.991207462041217 49.8103660362668,23.991195172145964 49.81036083077867,23.991143512346653 49.81034078229968,23.991090931041594 49.81032329279617,23.99103755490376 49.81030840440188,23.990983512520938 49.810296152984264,23.990928934085964 49.81028656805806,23.990873951083067 49.81027967271419,23.990818695971118 49.81027548356414,23.99076330186452 49.81027401069995))"}],[{"id":5,"role":2,"phoneNumber":"0666076708","vkProfile":{"id":"id_link8","type":3,"link":"https://www.facebook.com/app_scoped_user_id/1637344933216693/","imgUrl":"https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz=50","name":"Имя8","surName":"Фамилия8","gender":2,"age":34,"email":"email8","birthday":"1983-03-28"}},{"id":1578,"totalSeats":2,"depLocation":{"mLongitudeE6":24017314,"mLatitudeE6":49812844,"mAltitude":0},"destLocation":{"mLongitudeE6":24000663,"mLatitudeE6":49816720,"mAltitude":0},"depAddress":"From 3","destAddress":"To 3","timestamp":1444904927000,"clientType":1,"stateId":1,"price":30,"polygon":"POLYGON((24.01731968267015 49.81219603114531,24.017287881500387 49.81219653281676,24.012892885206675 49.81237382475058,24.012883489997005 49.812374272068716,24.0128517850148 49.8123767940076,24.01282024196831 49.81238086859844,24.008499809458893 49.81304713636209,24.008489763894296 49.81304876638168,24.008458550855075 49.81305487475749,24.00842767513712 49.81306250732674,24.008397211122745 49.813071645701896,24.004317632019184 49.81440537793822,24.004317135295654 49.81440554055326,24.0042871649528 49.81441618689637,24.004257753101832 49.81442829099052,24.000401761008522 49.81612699905673,24.000396014009652 49.81612956421996,24.000367364295403 49.81614337580734,24.000339426793463 49.81615857653291,24.00031226880772 49.81617512977678,24.000285955764138 49.81619299566075,24.000260551053145 49.816212131144326,24.000236115876916 49.81623249012846,24.000212709101927 49.81625402356658,24.000190387117158 49.81627667958274,24.000169203698217 49.81630040359662,24.000149209877815 49.816325138454985,24.000130453822823 49.81635082456939,24.00011298071822 49.81637740005976,24.00009683265824 49.81640480090338,24.00008204854498 49.816432961089234,24.000068663994654 49.81646181277697,24.000056711251826 49.816491286460334,24.0000462191117 49.81652131113466,24.000037212850753 49.81655181446786,24.000029714165862 49.81658272297473,24.000023741122018 49.81661396219398,24.0000193081088 49.816645456867604,24.00001642580573 49.816677131122155,24.000015101156524 49.81670890865159,24.000015337352387 49.81674071290105,24.000017133824294 49.816772467251326,24.000020486244388 49.81680409520339,24.000025386536397 49.81683552056275,24.00003182289509 49.816866667622946,24.000039779814713 49.816897461348,24.000049238126348 49.816927827553116,24.000060175044098 49.81695769308346,24.000072564219966 49.81698698599035,24.000086375807346 49.81701563570459,24.000101576532913 49.81704357320653,24.000118129776787 49.817070731192274,24.000135995660752 49.81709704423586,24.00015513114433 49.817122448946854,24.000175490128466 49.81714688412308,24.000197023566585 49.81717029089807,24.000219679582745 49.81719261288284,24.00024340359662 49.81721379630178,24.000268138454985 49.81723379012218,24.000293824569397 49.81725254617717,24.000320400059756 49.81727001928178,24.00034780090338 49.817286167341756,24.000375961089237 49.81730095145502,24.00040481277697 49.81731433600534,24.00043428646034 49.81732628874817,24.00046431113466 49.8173367808883,24.000494814467856 49.81734578714924,24.000525722974732 49.81735328583413,24.000556962193986 49.81735925887798,24.000588456867604 49.817363691891195,24.000620131122158 49.81736657419427,24.00065190865159 49.81736789884347,24.000683712901054 49.81736766264761,24.005101729851678 49.817226370034405,24.005116530812987 49.81722572724349,24.005148235794596 49.817223205297104,24.005179778840123 49.8172191306988,24.0095002091488 49.816552862228036,24.009510255434275 49.81655123208321,24.00954146846515 49.81654512366477,24.009572344172682 49.81653749105335,24.009602808174577 49.81652835263659,24.013682366251974 49.81519462110739,24.013689030413744 49.815192402340934,24.013718892422574 49.815181455811754,24.013748181340578 49.81516905720882,24.01758117600388 49.813434349821996,24.017585905311233 49.81343218656148,24.01761443873602 49.813418136303746,24.017642248377577 49.81340270290137,24.01766926724004 49.81338592353477,24.017695430232607 49.8133678386269,24.01772067432633 49.813348491745906,24.017744938705984 49.8133279295001,24.01776816491655 49.81330620142574,24.017790297004048 49.81328335986767,24.017811281650346 49.813259459853185,24.017831068301593 49.81323455895953,24.01784960929001 49.81320871717513,24.017866859948736 49.81318199675511,24.017882778719418 49.8131544620713,24.017897327252346 49.81312617945717,24.01791047049883 49.81309721704802,24.01792217679564 49.81306764461681,24.017932417941278 49.81303753340613,24.017941169263928 49.813006955956524,24.017948409680887 49.81297598593175,24.017954121749355 49.812944697941305,24.017958291708464 49.8129131673607,24.017960909512414 49.812881470149854,24.017961968854685 49.81284968267015,24.01796146718323 49.812817881500386,24.01795940570662 49.812786143252374,24.01795578939113 49.812754544386344,24.017950626948785 49.81272316102672,24.017943930816358 49.81269206877876,24.017935717125418 49.81266134254643,24.017926005663465 49.81263105635189,24.017914819826267 49.812601283157264,24.01790218656148 49.81257209468876,24.017888136303746 49.81254356126398,24.01787270290137 49.81251575162242,24.017855923534768 49.81248873275995,24.017837838626903 49.81246256976739,24.017818491745903 49.81243732567366,24.017797929500098 49.81241306129401,24.017776201425743 49.81238983508345,24.017753359867665 49.81236770299595,24.017729459853186 49.81234671834965,24.01770455895953 49.8123269316984,24.01767871717513 49.81230839070999,24.017651996755113 49.812291140051265,24.017624462071304 49.81227522128058,24.017596179457176 49.81226067274765,24.017567217048015 49.812247529501164,24.01753764461681 49.81223582320436,24.017507533406132 49.81222558205872,24.01747695595653 49.81221683073607,24.01744598593175 49.812209590319114,24.017414697941305 49.81220387825064,24.017383167360695 49.81219970829153,24.01735147014986 49.81219709048759,24.01731968267015 49.81219603114531))"}]],"stops":{"0":{"passengerId":4,"orderId":1577,"type":1,"length":1000},"1":{"passengerId":5,"orderId":1578,"type":1,"length":1000},"2":{"passengerId":1,"orderId":1575,"type":1,"length":1000},"3":{"passengerId":5,"orderId":1578,"type":2,"length":1000},"4":{"passengerId":2,"orderId":1576,"type":1,"length":1000},"5":{"passengerId":1,"orderId":1575,"type":2,"length":1000},"6":{"passengerId":4,"orderId":1577,"type":2,"length":1000},"7":{"passengerId":2,"orderId":1576,"type":2,"length":1000}},"stateId":1,"price":0}],"state":"success"}'


text2 = '{"list":[{"id":1591,"totalSeats":2,"depLocation":{"mLongitudeE6":24017941,"mLatitudeE6":49842879,"mAltitude":0},"destLocation":{"mLongitudeE6":24009442,"mLatitudeE6":49842361,"mAltitude":0},"depAddress":"Львов, улица Шевченко, 4","destAddress":"Львов, площадь Князя Святослава, 5","timestamp":1445008302000,"clientType":1,"stateId":1,"price":0,"polygon":"POLYGON((24.0137749403454 49.84080137935405,24.013713621904234 49.84080175355781,24.011598051109836 49.84086660816779,24.011558424182116 49.84086845308323,24.011497336221087 49.84087377776846,24.00930300420493 49.841119438516955,24.009254415324175 49.841125845460425,24.009194035117442 49.84113653760195,24.00913425227983 49.84115017958063,24.00907521083343 49.84116673853176,24.009017053014258 49.841186174563376,24.008959918929598 49.84120844085237,24.00890394622046 49.8412334837573,24.008849269730007 49.84126124294762,24.00879602117869 49.841291651549,24.008744328846934 49.84132463630447,24.008694317266098 49.84136011775085,24.008646106918455 49.841398010410245,24.008599813946955 49.841438222995905,24.008555549875425 49.84148065863219,24.00851342133989 49.84152521508795,24.008473529831683 49.84157178502276,24.008435971452936 49.84162025624558,24.008400836685077 49.84167051198498,24.00836821017084 49.84172243117049,24.008338170510353 49.84177588872424,24.008310790071793 49.84183075586231,24.00828613481703 49.84188690040495,24.008264264142735 49.841944187095045,24.008245230737277 49.84200247792393,24.0082290804538 49.842061632463896,24.008215852199747 49.84212150820648,24.008205577843142 49.842181960905776,24.008198282135815 49.842242844925934,24.008193982653754 49.842304013592006,24.008192689754797 49.84236531954333,24.008194406553645 49.8424266150885,24.008199128914384 49.84248775256117,24.008206845460432 49.84254858467582,24.008217537601947 49.84260896488255,24.008231179580633 49.84266874772017,24.008247738531765 49.84272778916657,24.00826717456338 49.842785946985735,24.00828944085237 49.8428430810704,24.008314483757303 49.84289905377953,24.00834224294762 49.84295373026999,24.008372651549006 49.84300697882131,24.008405636304474 49.84305867115306,24.00844111775086 49.8431086827339,24.008479010410248 49.84315689308154,24.008519222995908 49.84320318605304,24.008561658632196 49.84324745012457,24.008606215087948 49.843289578660105,24.00865278502276 49.843329470168314,24.008701256245576 49.843367028547064,24.008751511984983 49.84340216331492,24.008803431170495 49.84343478982915,24.00885688872425 49.84346482948964,24.008911755862318 49.84349220992821,24.008967900404954 49.84351686518297,24.009025187095045 49.84353873585726,24.00908347792393 49.843557769262716,24.009142632463902 49.843573919546195,24.011264299869644 49.84409758028335,24.011285471441223 49.84410261055244,24.01134556850533 49.84411479390753,24.01140619098879 49.84412401376407,24.0134906195926 49.84438886836223,24.01350273566346 49.844390347764374,24.01356379551789 49.84439598562149,24.013625058459585 49.84439862062251,24.013686376900754 49.84439824641949,24.01580194814664 49.84433339182131,24.015819978107157 49.84433270874711,24.01588114909157 49.84432844237609,24.018058481836135 49.84412278163895,24.018104224244563 49.844117609136575,24.018164803303545 49.84410810814355,24.018224843200766 49.844095646121346,24.018284199294854 49.84408025309208,24.01834272859178 49.84406196613889,24.018400290089343 49.84404082931666,24.018456745116847 49.84401689354584,24.018511957669194 49.8439902164898,24.018565794734506 49.843960862415905,24.018618126614577 49.843928902040695,24.018668827237324 49.843894412359504,24.018717774460505 49.843857476461,24.018764850365972 49.843818183326995,24.01880994154375 49.84377662761809,24.01885293936524 49.843732909445635,24.018893740244916 49.84368713413053,24.018932245889896 49.843639411949525,24.018968363536707 49.843589857869524,24.01900200617477 49.84353859127066,24.019033092756022 49.84348573565864,24.01906154839017 49.84343141836728,24.019087304525097 49.84337577025168,24.019110299112022 49.84331892537304,24.019130476754963 49.84326102067565,24.01914778884422 49.84320219565698,24.019162193673445 49.84314259203167,24.01917365654015 49.84308235339006,24.01918214982928 49.84302162485233,24.01918765307976 49.84296055271883,24.019190153033776 49.84289928411769,24.01918964366872 49.842837966650336,24.0191861262117 49.84277674803592,24.019179609136575 49.84271577575543,24.019170108143552 49.84265519669645,24.019157646121354 49.842595156799234,24.01914225309208 49.84253580070514,24.019123966138896 49.842477271408214,24.01910282931666 49.84241970991066,24.019078893545842 49.842363254883146,24.019052216489804 49.8423080423308,24.01902286241591 49.84225420526549,24.018990902040695 49.84220187338542,24.018956412359504 49.84215117276268,24.018919476461 49.84210222553949,24.018880183327 49.84205514963402,24.018838627618095 49.842010058456246,24.018794909445642 49.84196706063476,24.018749134130537 49.84192625975508,24.01870141194953 49.8418877541101,24.01865185786953 49.84185163646329,24.01860059127066 49.84181799382523,24.018547735658643 49.84178690724398,24.01849341836728 49.84175845160983,24.01843777025169 49.841732695474896,24.018380925373048 49.841709700887975,24.01832302067565 49.84168952324503,24.018264195656982 49.841672211155775,24.01615952782338 49.84110855040728,24.016114528082763 49.841097389425215,24.016054431018176 49.8410852060725,24.01599380853435 49.84107598621836,24.013909379178507 49.84081113160838,24.013897263141622 49.84080965221071,24.013836203287127 49.840804014354326,24.0137749403454 49.84080137935405))"},{"id":1592,"totalSeats":2,"depLocation":{"mLongitudeE6":24016675,"mLatitudeE6":49837226,"mAltitude":0},"destLocation":{"mLongitudeE6":24010987,"mLatitudeE6":49841473,"mAltitude":0},"depAddress":"Львов, улица Матейко, 6","destAddress":"Львов, улица Ярослава Мудрого, 12","timestamp":1445008305000,"clientType":1,"stateId":1,"price":0,"polygon":"POLYGON((24.016676586433082 49.83595248944587,24.01661409632103 49.835953945602526,24.016551752931278 49.83595846624964,24.016489706454507 49.83596604049659,24.016428106366117 49.835976650096335,24.01636710106612 49.83599026948943,24.01630683752162 49.836006865865556,24.016247460912776 49.836026399242606,24.016189114283044 49.83604882256295,24.014349693705903 49.83680805235939,24.014328888591084 49.83681685654732,24.0142721695643 49.83684312604479,24.014216807841215 49.83687214697023,24.0126606182795 49.83773724510468,24.012628611110227 49.83775565050552,24.012575681726332 49.83778890129223,24.012524447636974 49.83782470914868,24.012475032269553 49.83786298781061,24.01242755467003 49.837903645061374,24.01238212921609 49.83794658295409,24.011138302950062 49.8391814848196,24.01109962267714 49.83922160589312,24.011058374042538 49.83926857061009,24.011019479543158 49.839317502730566,24.009970915948042 49.84070527293417,24.009956186474337 49.84072516637976,24.00992073367784 49.84077664680048,24.009887849610315 49.840829804797046,24.009857613492347 49.8408845123072,24.009830098165402 49.840940637535745,24.009805369916307 49.840998045272094,24.009783488317584 49.84105659721599,24.00976450608392 49.84111615231066,24.009748468945173 49.84117656708267,24.009735415536223 49.841237695987544,24.00972537730387 49.841299391760394,24.0097183784311 49.8413615057707,24.009714435778804 49.84142388838037,24.009713558845185 49.84148638930423,24.009715749742846 49.841548857972086,24.00972100319372 49.84161114389145,24.009729306541796 49.841673097010066,24.00974063978357 49.84173456807747,24.009754975616275 49.841795409004455,24.009772279503633 49.841855473219915,24.009792509759063 49.841914616023885,24.009815617646108 49.841972694936175,24.009841547495846 49.84202957003959,24.009870236840996 49.842085104317036,24.00990161656641 49.84213916398157,24.009935611075587 49.842191618798715,24.009972138472772 49.84224234240024,24.01001111076027 49.84229121258853,24.010052434050422 49.84233811163103,24.010096008791805 49.842382926543834,24.01014173000905 49.84242554936389,24.010189487555742 49.8424658774091,24.010239166379765 49.84250381352567,24.01029064680048 49.842539266322156,24.01034380479705 49.842572150389685,24.010398512307198 49.84260238650765,24.010454637535744 49.8426299018346,24.010512045272094 49.84265463008369,24.010570597215988 49.84267651168242,24.010630152310657 49.84269549391608,24.01069056708267 49.842711531054825,24.010751695987544 49.84272458446378,24.010813391760394 49.84273462269613,24.0108755057707 49.842741621568905,24.01093788838037 49.8427455642212,24.011000389304233 49.842746441154816,24.01106285797209 49.842744250257155,24.011125143891444 49.842738996806276,24.01118709701007 49.84273069345821,24.011248568077466 49.84271936021643,24.011309409004458 49.842705024383726,24.011369473219915 49.842687720496365,24.01142861602389 49.842667490240935,24.011486694936174 49.84264438235389,24.013264136086253 49.841886151414954,24.01326957203878 49.84188381757739,24.013326326078378 49.84185762380932,24.013381726487964 49.84182867680405,24.013435639803102 49.841797046297465,24.014991818475412 49.840831946973935,24.015031673549892 49.84080618961187,24.01508265802765 49.840770027234676,24.015131806688625 49.8407314067269,24.01517900112939 49.840690421128734,24.016422806628785 49.8395555204523,24.016431555494513 49.839547462425394,24.016476276092494 49.83950379089447,24.016518799962093 49.83945797763209,24.016559024659596 49.839410133006396,24.01766959933781 49.838021363945295,24.017696948231414 49.83798590358636,24.017733003951708 49.83793484362621,24.017766510847814 49.83788207599968,24.01779738819868 49.837827727828596,24.017825561618068 49.83777193004248,24.01785096323374 49.83771481706306,24.01787353185098 49.83765652648053,24.01789321310001 49.837597198721994,24.017909959566982 49.837536976713224,24.017923730908187 49.83747600553431,24.01793449394726 49.83741443207017,24.01794222275509 49.83735240465667,24.01794689871231 49.83729007272328,24.017948510554127 49.83722758643308,24.017947054397474 49.83716509632103,24.017942533750357 49.83710275293128,24.017934959503414 49.83704070645451,24.01792434990367 49.83697910636612,24.01791073051057 49.83691810106612,24.01789413413444 49.83685783752162,24.017874600757395 49.83679846091278,24.017852177437053 49.836740114283046,24.017826918193155 49.83668293819456,24.017798883877436 49.83662707038954,24.017768142027013 49.8365726454584,24.0177347667017 49.83651979451559,24.01769883830558 49.836468644883645,24.0176604433933 49.83641931978651,24.017619674461574 49.83637193805266,24.017576629726328 49.83632661382885,24.017531412886093 49.83628345630511,24.017484132872205 49.836242569451684,24.017434903586356 49.83620405176859,24.01738384362621 49.836167996048296,24.017331075999678 49.83613448915219,24.017276727828598 49.83610361180132,24.017220930042473 49.83607543838193,24.01716381706306 49.83605003676626,24.017105526480528 49.83602746814902,24.01704619872199 49.83600778689999,24.01698597671322 49.835991040433015,24.01692500553431 49.83597726909181,24.01686343207017 49.83596650605274,24.01680140465667 49.83595877724491,24.016739072723276 49.83595410128769,24.016676586433082 49.83595248944587))"},{"id":1593,"totalSeats":2,"depLocation":{"mLongitudeE6":24026726,"mLatitudeE6":49833903,"mAltitude":0},"destLocation":{"mLongitudeE6":24016548,"mLatitudeE6":49843030,"mAltitude":0},"depAddress":"Львов, улица Грабовского, 11","destAddress":"Львов, улица Шевченко, 14","timestamp":1445008308000,"clientType":1,"stateId":1,"price":0,"polygon":"POLYGON((24.02677195900088 49.83135217690859,24.026646741889074 49.8313530434531,24.026521718126094 49.831360053066284,24.026397188905126 49.83137318886137,24.026273454227972 49.83139241919307,24.026150812182312 49.83141769773383,24.02602955822357 49.83144896358545,24.02590998446316 49.831486141425735,24.025792378964734 49.83152914169001,24.02567702505025 49.831577860786886,24.025564200617385 49.831632181347786,24.022222587989262 49.83334329337213,24.02214214119762 49.83338631968536,24.022034326153126 49.83345000635718,24.021929765933447 49.833518906549116,24.01898059692586 49.83556780995441,24.018943782696773 49.83559387175803,24.01884405233308 49.835669594479484,24.018748157636814 49.835750119526615,24.018656329626697 49.83583525290753,24.018568789524448 49.83592478952845,24.018485748221842 49.83601851368781,24.01633483972983 49.83856961028206,24.016333712226604 49.83857094849433,24.016255436798506 49.83866868811446,24.016182051512434 49.83877015079615,24.016113733159976 49.83887509210692,24.014377423287698 49.84169098008303,24.014344379823218 49.84174611151902,24.014284037962913 49.84185583360378,24.014229152594545 49.841968384358225,24.01417985594177 49.842083492637734,24.014136266764545 49.84220088113639,24.014098490073014 49.84232026705501,24.014066616874537 49.84244136278246,24.01404072395444 49.84256387658852,24.014020873691035 49.84268751332671,24.014007113905347 49.842811975145295,24.013999477745905 49.84293696220485,24.01399798360888 49.843062173400604,24.01400263509379 49.84318730708782,24.01401342099479 49.843312061808476,24.014030315327705 49.843436137017534,24.01405327739261 49.84355923380694,24.014082251871873 49.84368105562576,24.014117168963438 49.84380130899454,24.01415794454897 49.8439197042124,24.01420448039652 49.84403595605488,24.01425666439715 49.844149784461116,24.01431437083503 49.8442609152085,24.014377460690298 49.84436908057333,24.014445781973972 49.84447401997578,24.014519170094086 49.84457548060762,24.01459744825224 49.8446732180413,24.014680427869486 49.8447669968188,24.014767909040664 49.84485659101882,24.014859681015967 49.84494178480108,24.01495552270867 49.8450223729263,24.01505520322774 49.84509816125064,24.015158482434074 49.845168967193366,24.015265111519025 49.84523462017678,24.015374833603776 49.84529496203708,24.015487384358224 49.84534984740545,24.015602492637736 49.84539914405823,24.01571988113639 49.84544273323545,24.015839267055007 49.84548050992698,24.015960362782458 49.84551238312546,24.01608287658852 49.84553827604556,24.01620651332671 49.84555812630896,24.016330975145294 49.845571886094646,24.016455962204848 49.84557952225409,24.016581173400603 49.845581016391115,24.016706307087816 49.84557636490621,24.016831061808475 49.8455655790052,24.016955137017533 49.84554868467229,24.01707823380694 49.84552572260739,24.017200055625754 49.84549674812813,24.017320308994538 49.84546183103656,24.0174387042124 49.84542105545103,24.01755495605488 49.845374519603475,24.01766878446111 49.84532233560285,24.02103449433369 49.84367821786928,24.021084188685187 49.84365326821997,24.021194035352284 49.84359315344878,24.02130080001224 49.84352772116797,24.021404225459648 49.84345712900965,24.02425333751333 49.8414082196621,24.02431083173349 49.841365637605755,24.024408510150604 49.84128728581689,24.024502226369723 49.84120423555343,24.024591754620275 49.84111668689073,24.024676879220856 49.841024850741185,24.026927689662514 49.8384737600892,24.026993180174518 49.83839649343426,24.027069825871262 49.838297470643155,24.027141520426845 49.83819480630326,24.0272080911228 49.83808874774194,24.028920458754882 49.83520586547505,24.0289554315996 49.83514509998041,24.029013694313466 49.8350342598606,24.029066448180437 49.83492069443669,24.029113566111835 49.83480467729775,24.029154934596427 49.83468648793922,24.029190453973918 49.83456641108962,24.02922003867501 49.834444736024594,24.029243617427568 49.834321755870036,24.029261133428317 49.83419776689591,24.02927254447967 49.834073067802514,24.02927782309141 49.83394795900088,24.029276956546898 49.83382274188908,24.029269946933713 49.833697718126096,24.02925681113863 49.83357318890513,24.029237580806928 49.833449454227974,24.02921230226616 49.833326812182314,24.02918103641455 49.833205558223575,24.029143858574265 49.83308598446316,24.029100858309985 49.832968378964736,24.02905213921311 49.83285302505025,24.02899781865221 49.83274020061739,24.02893802749028 49.83263017747009,24.02887290976946 49.832523220663745,24.02880262236405 49.832419587866674,24.02872733460256 49.83231952873937,24.028647227859803 49.832223284333026,24.028562495119942 49.83213108650885,24.028473340511564 49.83204315737948,24.028379978815934 49.83195970877388,24.02828263494955 49.83188094172706,24.028181543422317 49.831807045995724,24.028076947772576 49.831738199601176,24.02796909998041 49.831674568400395,24.027858259860597 49.83161630568653,24.02774469443669 49.831563551819556,24.02762867729775 49.83151643388816,24.027510487939217 49.831475065403566,24.027390411089616 49.83143954602608,24.027268736024592 49.83140996132499,24.027145755870034 49.831386382572425,24.027021766895906 49.83136886657168,24.02689706780251 49.831357455520326,24.02677195900088 49.83135217690859))"},{"id":1593,"totalSeats":2,"depLocation":{"mLongitudeE6":24026726,"mLatitudeE6":49833903,"mAltitude":0},"destLocation":{"mLongitudeE6":24016548,"mLatitudeE6":49843030,"mAltitude":0},"depAddress":"Львов, улица Грабовского, 11","destAddress":"Львов, улица Шевченко, 14","timestamp":1445008308000,"clientType":1,"stateId":1,"price":0,"polygon":"POLYGON((24.02677195900088 49.83135217690859,24.026646741889074 49.8313530434531,24.026521718126094 49.831360053066284,24.026397188905126 49.83137318886137,24.026273454227972 49.83139241919307,24.026150812182312 49.83141769773383,24.02602955822357 49.83144896358545,24.02590998446316 49.831486141425735,24.025792378964734 49.83152914169001,24.02567702505025 49.831577860786886,24.025564200617385 49.831632181347786,24.022222587989262 49.83334329337213,24.02214214119762 49.83338631968536,24.022034326153126 49.83345000635718,24.021929765933447 49.833518906549116,24.01898059692586 49.83556780995441,24.018943782696773 49.83559387175803,24.01884405233308 49.835669594479484,24.018748157636814 49.835750119526615,24.018656329626697 49.83583525290753,24.018568789524448 49.83592478952845,24.018485748221842 49.83601851368781,24.01633483972983 49.83856961028206,24.016333712226604 49.83857094849433,24.016255436798506 49.83866868811446,24.016182051512434 49.83877015079615,24.016113733159976 49.83887509210692,24.014377423287698 49.84169098008303,24.014344379823218 49.84174611151902,24.014284037962913 49.84185583360378,24.014229152594545 49.841968384358225,24.01417985594177 49.842083492637734,24.014136266764545 49.84220088113639,24.014098490073014 49.84232026705501,24.014066616874537 49.84244136278246,24.01404072395444 49.84256387658852,24.014020873691035 49.84268751332671,24.014007113905347 49.842811975145295,24.013999477745905 49.84293696220485,24.01399798360888 49.843062173400604,24.01400263509379 49.84318730708782,24.01401342099479 49.843312061808476,24.014030315327705 49.843436137017534,24.01405327739261 49.84355923380694,24.014082251871873 49.84368105562576,24.014117168963438 49.84380130899454,24.01415794454897 49.8439197042124,24.01420448039652 49.84403595605488,24.01425666439715 49.844149784461116,24.01431437083503 49.8442609152085,24.014377460690298 49.84436908057333,24.014445781973972 49.84447401997578,24.014519170094086 49.84457548060762,24.01459744825224 49.8446732180413,24.014680427869486 49.8447669968188,24.014767909040664 49.84485659101882,24.014859681015967 49.84494178480108,24.01495552270867 49.8450223729263,24.01505520322774 49.84509816125064,24.015158482434074 49.845168967193366,24.015265111519025 49.84523462017678,24.015374833603776 49.84529496203708,24.015487384358224 49.84534984740545,24.015602492637736 49.84539914405823,24.01571988113639 49.84544273323545,24.015839267055007 49.84548050992698,24.015960362782458 49.84551238312546,24.01608287658852 49.84553827604556,24.01620651332671 49.84555812630896,24.016330975145294 49.845571886094646,24.016455962204848 49.84557952225409,24.016581173400603 49.845581016391115,24.016706307087816 49.84557636490621,24.016831061808475 49.8455655790052,24.016955137017533 49.84554868467229,24.01707823380694 49.84552572260739,24.017200055625754 49.84549674812813,24.017320308994538 49.84546183103656,24.0174387042124 49.84542105545103,24.01755495605488 49.845374519603475,24.01766878446111 49.84532233560285,24.02103449433369 49.84367821786928,24.021084188685187 49.84365326821997,24.021194035352284 49.84359315344878,24.02130080001224 49.84352772116797,24.021404225459648 49.84345712900965,24.02425333751333 49.8414082196621,24.02431083173349 49.841365637605755,24.024408510150604 49.84128728581689,24.024502226369723 49.84120423555343,24.024591754620275 49.84111668689073,24.024676879220856 49.841024850741185,24.026927689662514 49.8384737600892,24.026993180174518 49.83839649343426,24.027069825871262 49.838297470643155,24.027141520426845 49.83819480630326,24.0272080911228 49.83808874774194,24.028920458754882 49.83520586547505,24.0289554315996 49.83514509998041,24.029013694313466 49.8350342598606,24.029066448180437 49.83492069443669,24.029113566111835 49.83480467729775,24.029154934596427 49.83468648793922,24.029190453973918 49.83456641108962,24.02922003867501 49.834444736024594,24.029243617427568 49.834321755870036,24.029261133428317 49.83419776689591,24.02927254447967 49.834073067802514,24.02927782309141 49.83394795900088,24.029276956546898 49.83382274188908,24.029269946933713 49.833697718126096,24.02925681113863 49.83357318890513,24.029237580806928 49.833449454227974,24.02921230226616 49.833326812182314,24.02918103641455 49.833205558223575,24.029143858574265 49.83308598446316,24.029100858309985 49.832968378964736,24.02905213921311 49.83285302505025,24.02899781865221 49.83274020061739,24.02893802749028 49.83263017747009,24.02887290976946 49.832523220663745,24.02880262236405 49.832419587866674,24.02872733460256 49.83231952873937,24.028647227859803 49.832223284333026,24.028562495119942 49.83213108650885,24.028473340511564 49.83204315737948,24.028379978815934 49.83195970877388,24.02828263494955 49.83188094172706,24.028181543422317 49.831807045995724,24.028076947772576 49.831738199601176,24.02796909998041 49.831674568400395,24.027858259860597 49.83161630568653,24.02774469443669 49.831563551819556,24.02762867729775 49.83151643388816,24.027510487939217 49.831475065403566,24.027390411089616 49.83143954602608,24.027268736024592 49.83140996132499,24.027145755870034 49.831386382572425,24.027021766895906 49.83136886657168,24.02689706780251 49.831357455520326,24.02677195900088 49.83135217690859))"}],"state":"success"}'


url = 'http://188.40.133.134:8480/GatherCarBackend/GCServlet'
pot_routes_req = {"action": "get_potential_routes", "weight": 8, "include_polygons": "true"}
active_order_req = {"action": "get_active_orders"}

def get_json(url, request):
    # headers = {'Accept-Encoding': 's'}
    response = requests.post(url, data=json.dumps(request))
    output = json.loads(response.text)
    if 'list' in output:
        return output['list']
    else:
        return output
    # cnt = len(output['list'])
    # for i in range(cnt):
    #     return output['list'][0]
    # return output['list']


def get_routes_cnt():
    json = get_json(url, pot_routes_req)
    cnt = len(json)
    return cnt


def get_cnt_active_order():
    json = get_json(url, active_order_req)
    cnt = len(json)
    return cnt


def get_active_order_by_pos(pos):
    order = get_json(url, active_order_req)[pos]
    return order


def get_route_by_pos(pos):
    route = get_json(url, pot_routes_req)[pos]
    return route


def get_coord_by_order_id(order_id, route_pos, start=True):
    passenger = 0
    route_info = {}
    # for i in range(get_routes_cnt()):
    route = get_route_by_pos(route_pos)
    for order in range(len(route['stops'])):
        id = str(order)
        if order_id == route['stops'][id]['orderId']:
            passengerId = route['stops'][id]['passengerId']
            passenger = passengerId
    # for i in range(get_routes_cnt()):
    route = get_route_by_pos(route_pos)
    for order in range(len(route['passengerOrderHashMap'])):
        if route['passengerOrderHashMap'][order][0]['id'] == passenger:
            order_amount = get_amount_orders(route)
            passenger_amount = get_amount_passengers(route)
            order_ids = get_order_ids(route)
            route_polygons = get_pot_polygons(route)
            totalSeats = route['passengerOrderHashMap'][order][1]['totalSeats']
            user_id = str(route['passengerOrderHashMap'][order][0]['id'])
            if start:
                lat = route['passengerOrderHashMap'][order][1]['depLocation']['mLatitudeE6']
                lng = route['passengerOrderHashMap'][order][1]['depLocation']['mLongitudeE6']
                route_info.update({"lat": lat/float(1000000), "lng": lng/float(1000000), "description": ('<p><b>User id: </b>'+user_id+'', '<p><b>Order Id: </b>'+str(order_id)+'', '<p><b>Get On</b>', '<p><b>lat: </b>'+str(lat)+'<p><b>lng: </b>'+str(lng)+'', '<p><b>Passengers amount: </b>'+str(totalSeats)+''), "label": 'S', "amount_orders": order_amount,
                                   "passenger_amount": passenger_amount, "list_orders_id": order_ids, "polygons": route_polygons})
            else:
                lat = route['passengerOrderHashMap'][order][1]['destLocation']['mLatitudeE6']
                lng = route['passengerOrderHashMap'][order][1]['destLocation']['mLongitudeE6']
                route_info.update({"lat": lat/float(1000000), "lng": lng/float(1000000), "description": ('<p><b>User id: </b>'+user_id+'', '<p><b>Order Id: </b>'+str(order_id)+'', '<p><b>Get Off</b>', '<p><b>lat: </b>'+str(lat)+'<p><b>lng: </b>'+str(lng)+'', '<p><b>Passengers amount: </b>'+str(totalSeats)+''), "label": 'F', "amount_orders": order_amount,
                                   "passenger_amount": passenger_amount, "list_orders_id": order_ids, "polygons": route_polygons})
    return route_info


def get_amount_orders(route):
    amount = (len(route['passengerOrderHashMap']))
    return amount


def get_pot_polygons(route):
    polygons = []
    for order in range(len(route['passengerOrderHashMap'])):
        polygon = []
        poly = route['passengerOrderHashMap'][order][1]['polygon']
        poly = poly.split('((')[1].split('))')[0].split(',')
        for i in range(len(poly)):
            lng = float(poly[i].split(' ')[0])
            lat = float(poly[i].split(' ')[1])
            coord = {"lat": lat, "lng": lng}
            polygon.append(coord)
        polygons.append(polygon)
    return polygons


def get_polygons_of_active_orders(order):
    polygons = []
    # for i in range(get_cnt_active_order()):
    polygon = []
    poly = order['polygon']
    poly = poly.split('((')[1].split('))')[0].split(',')
    for i in range(len(poly)):
        lng = float(poly[i].split(' ')[0])
        lat = float(poly[i].split(' ')[1])
        coord = {"lat": lat, "lng": lng}
        polygon.append(coord)
    polygons.append(polygon)
    return polygons


def get_amount_passengers(route):
    amount_passengers = 0
    for order in range(len(route['passengerOrderHashMap'])):
        amount_passengers += route['passengerOrderHashMap'][order][1]['totalSeats']
    return amount_passengers


def get_order_ids(route):
    ids = []
    for order in range(len(route['passengerOrderHashMap'])):
        ids.append(route['passengerOrderHashMap'][order][1]['id'])
    return ids


def get_cord_of_all_routes():
    routes = []
    for i in range(get_routes_cnt()):
        route = get_route_by_pos(i)
        coor_one_route = []
        for order in range(len(route['stops'])):
            id = str(order)
            type = route['stops'][id]['type']
            order_id = route['stops'][id]['orderId']
            if type == 1:
                cor = get_coord_by_order_id(order_id, i, start=True)
                coor_one_route.append(cor)
            else:
                cor = get_coord_by_order_id(order_id, i, start=False)
                coor_one_route.append(cor)
        routes.append(coor_one_route)
    return routes


def get_info_of_all_active_orders():
    orders_info = []
    for i in range(get_cnt_active_order()):
        order = get_active_order_by_pos(i)
        order_id = order["id"]
        polygons = get_polygons_of_active_orders(order)
        lat_start = order["depLocation"]["mLatitudeE6"]
        lng_start = order["depLocation"]["mLongitudeE6"]
        time = str(datetime.fromtimestamp(order["timestamp"]/1000))
        orders_info.append([{"lat": lat_start/float(1000000), "lng": lng_start/float(1000000), "polygons": [], "label": "S", "description": ('<p><b>Order Id: </b>'+str(order_id)+'', '<p><b>Get On</b>', '<p><b>Active order</b>', '<p><b>Time: </b>'+time+'', '<p><b>lat: </b>'+str(lat_start)+'<p><b>lng: </b>'+str(lng_start)+'')}])
        lat_finish = order["destLocation"]["mLatitudeE6"]
        lng_finish = order["destLocation"]["mLongitudeE6"]
        orders_info.append([{"lat": lat_finish/float(1000000), "lng": lng_finish/float(1000000), "polygons": polygons, "label": "F", "description": ('<p><b>Order Id: </b>'+str(order_id)+'', '<p><b>Get Off</b>', '<p><b>Active order</b>', '<p><b>Time: </b>'+time+'', '<p><b>lat: </b>'+str(lat_start)+'<p><b>lng: </b>'+str(lng_start)+'')}])
    return orders_info



def search_form(request):
    return render(request, 'search_form.html')

def convert_froms_date_into_timestamp(date, time):
    date_time = date + " " + time
    from datetime import datetime
    import time
    date_obj = datetime.strptime(date_time, "%Y-%m-%d %H:%M:%S")
    return time.mktime(date_obj.timetuple()) * 1000

def google_maps(request):
    routes = get_cord_of_all_routes()
    json_for_js = json.dumps(get_cord_of_all_routes())
    output = json.dumps("1321")
    add_order_reauest = json.dumps("3535")
    active_orders = json.dumps(get_info_of_all_active_orders())
    if request.method == 'POST':
        form = ContactForm(request.POST)
        lat_from = form['lat_from'].value()
        lon_from = form['lon_from'].value()
        lat_to = form['lat_to'].value()
        lon_to = form['lon_to'].value()
        people = form['people'].value()
        user_id = form['user_id'].value()
        date = form['date'].value()
        time = form['time'].value()
        timestamp = convert_froms_date_into_timestamp(date, time)
        form = ContactForm()
        json_send = {
            "action": "set_order",
            "cancel_active_order": True,
            "order": {
                "timestamp": timestamp,
                "depAddress": "Киев, Приборный переулок, 10",
                "depLocation": {
                    "mAltitude": 0,
                    "mLatitudeE6": lat_from,
                    "mLongitudeE6": lon_from},
                "destAddress": "Киев, переулок Раисы Букиной, 3",
                "destLocation": {
                    "mAltitude": 0,
                    "mLatitudeE6": lat_to,
                    "mLongitudeE6": lon_to},
                "id": 5,
                "stateId": 0,
                "clientType": 1,
                "totalSeats": people},
            "user": {
                "email": "azhovnuvhome@gmail.com",
                "gPlusProfile": {
                    "id": "106646917423760946921",
                    "imgUrl": "https://lh3.googleusercontent.com/-RAgLglo1zEg/AAAAAAAAAAI/AAAAAAAACB4/tObTcEGkReE/photo.jpg?sz\u003d50",
                    "link": "https://plus.google.com/+AlexanderZhovnuvaty",
                    "type": 1},
                "surName": "Zhovnuvaty",
                "name": "Alexander",
                "role": 2,
                "id": user_id,
                "gender": 1}}
        url = 'http://188.40.133.134:8480/GatherCarBackend/GCServlet'
        headers = {'Accept-Encoding': 's'}
        response = requests.post(url, data=json.dumps(json_send), headers=headers)
        output = json.loads(response.text)
        active_orders = json.dumps(get_info_of_all_active_orders())
        add_order_reauest = json.dumps(json_send)
        return HttpResponseRedirect('')
    else:
        form = ContactForm()
    return render(request, 'google_maps.html', {'test1': output, 'test': active_orders, 'json': json_for_js, 'routes': routes, 'form': form})

def search(request):
    errors = []
    if 'q' in request.GET:
        q = request.GET['q']
        if not q:
            errors.append('Enter a search term.')
        elif len(q) > 20:
            errors.append('Please enter at most 20 characters.')
        else:
            books = Book.objects.filter(title__icontains=q)
            return render(request, 'search_results.html',
                {'books': books, 'query': q})
    return render(request, 'search_form.html',
        {'errors': errors})


# def contact(request):
#     # if request.method == 'POST':
#     #     form = ContactForm(request.POST)
#     #     if form.is_valid():
#     #         cd = form.cleaned_data
#     #         send_mail(
#     #             cd['subject'],
#     #             cd['message'],
#     #             cd.get('email', 'noreply@example.com'),
#     #             ['siteowner@example.com'],
#     #         )
#     #         return HttpResponseRedirect('/contact/thanks/')
#     # else:
#     #     form = ContactForm(
#     #         initial={'subject': 'I love your site!'}
#     #     )
#     form = get_cord_of_all_routes()
#     points = json.dumps(get_cord_of_all_routes())
#     return render(request, 'google_maps.html', {'json': form})

